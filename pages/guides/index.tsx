import { GetServerSideProps, NextPage } from 'next'
import Head from 'next/head'
import { Fragment } from 'react'
import { GuidesEntry } from '../../components/guides/GuidesEntry'
import { GridGuides } from '../../components/grid/GridGuides'
import { TRestGuides, TRestGuidesCategory } from '../../utils/types/TGuides'
import { IGuidesPageProps } from '../../utils/interfaces/IGuides'
import { GridGuideItem } from '../../components/grid/GridGuideItem'

const Guides: NextPage<IGuidesPageProps> = ({ guides }) => {
    const { data } = guides

    return (
        <Fragment>
            <Head>
                <title>{'Baza danych MGW | Spis poradnik√≥w'}</title>
                <meta name={'description'} content={'Generated by create next app'} />
            </Head>
            <GuidesEntry />
            <GridGuides>
                {data.map((item: TRestGuidesCategory, index: number) => (
                    <GridGuideItem
                        key={item.id}
                        id={item.id}
                        name={item.name}
                        description={item.description}
                        link={item.link}
                        title={item.title}
                    />
                ))}
            </GridGuides>
        </Fragment>
    )
}

export default Guides

export const getServerSideProps: GetServerSideProps = async (context) => {
    const response: Response = await fetch('http://localhost:3000/api/guides', {
        credentials: 'include',
    })
    const guides: TRestGuides = await response.json()

    return {
        props: { guides },
    }
}
